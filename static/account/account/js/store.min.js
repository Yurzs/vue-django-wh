$(document).ready(function(){$("input[type=checkbox]").removeAttr("checked");$(':input[type="submit"]').prop("disabled",true)});jQuery(".js-counter").bind("input propertychange",function(){var a=$(this);if($("#count-"+a.data("counter")).val()<1){$("#count-"+a.data("counter")).val(1)}if($("#count-"+a.data("counter")).val()>65535){$("#count-"+a.data("counter")).val(1)}if($("#enchant-"+a.data("counter")).val()==0){$("#sub_price-"+a.data("counter")+" span").text(Number($("#count-"+a.data("counter")).val()*$("#sub_price-"+a.data("counter")).data("price")).toFixed(2)+" ₽")}if(!$("#enchant-"+a.data("counter")).val()){$("#sub_price-"+a.data("counter")+" span").text(Number($("#count-"+a.data("counter")).val()*$("#sub_price-"+a.data("counter")).data("price")).toFixed(2)+" ₽")}else{$("#sub_price-"+a.data("counter")+" span").text(Number(($("#enchant-"+a.data("counter")).val()/20+1)*$("#count-"+a.data("counter")).val()*$("#sub_price-"+a.data("counter")).data("price")).toFixed(0)+" ₽")}});jQuery(".enchant").bind("input propertychange",function(){var a=$(this);if($("#enchant-"+a.data("counter")).val()<1){$("#enchant-"+a.data("counter")).val(0)}if($("#enchant-"+a.data("counter")).val()>65535){$("#enchant-"+a.data("counter")).val(65535)}$("#sub_price-"+a.data("counter")+" span").text(Number($("#count-"+a.data("counter")).val()*($("#enchant-"+a.data("counter")).val()/20+1)*$("#sub_price-"+a.data("counter")).data("price")).toFixed(0)+" ₽")});jQuery(".js-sum").on("DOMSubtreeModified",function(){var a=0;for(i=0;i<$(".gds-buy-summ").data("count")+1;i++){if($("#customControlInline"+i).prop("checked")){a+=Number($("#sub_price-"+i+" span").text().replace(" ₽",""))}}$("#total_sum span").text(a)});jQuery(".js-button").on("change",function(){var a=0;console.log($(".gds-buy-summ").data("count"));for(i=0;i<$(".gds-buy-summ").data("count")+1;i++){if($("#customControlInline"+i).prop("checked")){a+=Number($("#sub_price-"+i+" span").text().replace(" ₽",""))}}$("#total_sum span").text(a)});$(".order-summ").click(function(){$(':input[type="submit"]').prop("disabled",true)});jQuery(".order-summ").on("DOMSubtreeModified",function(){var a=Number($(".account-balance").text());var b=Number($(".order-summ").text());if(b>a){$("#buy button").prop("disabled",true).css("background-color","#7D2920")}else{$("#buy button").prop("disabled",false).css("background-color","#197d24")}if(b==0){$("#buy button").prop("disabled",true).css("background-color","#6c757d")}});$("#buy").on("submit",function(a){$(':input[type="submit"]').prop("disabled",true);a.preventDefault();console.log("form submitted!");buy_item()});function buy_item(){var b=[];var a=[];var c=[];jQuery($(".js-button:checkbox:checked").each(function(){b.push($(this).val());a.push($("#count-"+$(this).data("counter")).val());c.push($("#enchant-"+$(this).data("counter")).val())}));$.ajax({url:"/account/store/item",type:"POST",data:{csrfmiddlewaretoken:document.getElementsByName("csrfmiddlewaretoken")[0].value,character:$("#character option:selected").attr("value"),item:b,count:a,enchant:c},success:function(e){console.log(e);console.log("success");if(e.error){var d=[];for(var f in JSON.parse(e)){$("."+f).css("background-color","#ffdbde8c");d.push(JSON.parse(e)[f][0]["message"])}$(':input[type="submit"]').prop("disabled",true).css("background-color","#6c757d")}else{$(".account-balance").text(e.balance);$("input[type=checkbox]").each(function(){$(this).prop("checked",false)});$(':input[type="submit"]').prop("disabled",true).css("background-color","#6c757d")}},error:function(e,f,d){$(".operation-status").html("<span>"+JSON.parse(e.responseText).error+"</span>");console.log(e.status+": "+e.responseText)}})};